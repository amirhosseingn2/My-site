<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ - Ú¯Ø±ÙˆÙ‡Ø§Ù† Ø´Ù‡ÛŒØ¯ ØªÙˆÚ©Ù„ÛŒ</title>
    <style>
        /* Reset Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§ÛŒÙ‡ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }

        body {
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ */
        .ration-page {
            min-height: 100vh;
            padding: 20px;
        }

        /* Ù‡Ø¯Ø± */
        .page-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.2);
        }

        .page-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-header p {
            opacity: 0.9;
        }

        /* Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª */
        .status-bar {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-tag {
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        /* ÙØ±Ù… Ø§ØµÙ„ÛŒ */
        .main-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .form-title {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #27ae60;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
        }

        /* Ú¯Ø±ÛŒØ¯ ÙØ±Ù… */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ ÙØ±Ù… */
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            color: #27ae60;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d4edda;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        /* Ø±Ø¯ÛŒÙ Ø±ÙˆØ²Ù‡Ø§ */
        .day-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .day-row:last-child {
            border-bottom: none;
        }

        .day-name {
            font-weight: 600;
            color: #2c3e50;
            min-width: 100px;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #27ae60;
            cursor: pointer;
        }

        /* Ø¨Ø®Ø´ Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„ */
        .weekend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .weekend-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .weekend-item label {
            display: block;
            margin-bottom: 15px;
            font-weight: 600;
            color: #2c3e50;
        }

        .weekend-item select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            min-width: 180px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-3px);
        }

        /* ØªØ§Ø±ÛŒØ®Ú†Ù‡ */
        .history-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .history-header h2 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Ø¬Ø¯ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Ø¢Ù…Ø§Ø± */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #f8f9fa;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: #27ae60;
        }

        /* Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª */
        .back-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        /* ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Ù„ÛŒ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            color: #ddd;
        }

        /* ØªÚ¯â€ŒÙ‡Ø§ */
        .tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin: 2px;
        }

        .tag-eaten {
            background: #d4edda;
            color: #155724;
        }

        .tag-not-eaten {
            background: #f8d7da;
            color: #721c24;
        }

        /* Ù†Ø§ÙˆØ¨Ø±ÛŒ */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="ration-page">
        <!-- Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
        <div class="nav-bar">
            <div class="user-info">
                <div class="avatar" id="userAvatar">U</div>
                <div>
                    <div id="userName" style="font-weight: bold; color: #2c3e50;">Ú©Ø§Ø±Ø¨Ø±</div>
                    <div id="userDorm" style="font-size: 0.9rem; color: #7f8c8d;">Ø®ÙˆØ§Ø¨Ú¯Ø§Ù‡: -</div>
                </div>
            </div>
            <button onclick="window.location.href='dashboard.html'" class="btn btn-secondary">
                <i class="fas fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
            </button>
        </div>

        <!-- Ù‡Ø¯Ø± ØµÙØ­Ù‡ -->
        <div class="page-header">
            <h1><i class="fas fa-chart-bar"></i> Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ Ù‡ÙØªÚ¯ÛŒ</h1>
            <p>Ø«Ø¨Øª Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ ØºØ°Ø§ÛŒÛŒ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ</p>
            
            <div class="status-bar">
                <div>
                    <p><i class="fas fa-clock"></i> <strong>Ù…Ù‡Ù„Øª Ø«Ø¨Øª:</strong> <span id="deadlineText">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></p>
                </div>
                <div id="statusTag" class="status-tag">
                    <i class="fas fa-clock"></i>
                    <span>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</span>
                </div>
            </div>
        </div>

        <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… -->
        <div id="messageContainer"></div>

        <!-- ÙØ±Ù… Ø§ØµÙ„ÛŒ -->
        <div class="main-form">
            <h2 class="form-title"><i class="fas fa-edit"></i> ÙØ±Ù… Ø«Ø¨Øª Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡</h2>
            <p style="color: #666; margin-bottom: 25px;">Ù„Ø·ÙØ§Ù‹ Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ ØºØ°Ø§ÛŒÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯.</p>
            
            <form id="rationForm">
                <div class="form-grid">
                    <!-- Ø¨Ø®Ø´ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¹Ø§Ø¯ÛŒ -->
                    <div class="form-section">
                        <h3 class="section-title"><i class="fas fa-sun"></i> ØµØ¨Ø­Ø§Ù†Ù‡ (Ø´Ù†Ø¨Ù‡ ØªØ§ Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡)</h3>
                        <p style="color: #666; margin-bottom: 20px;">Ø±ÙˆØ²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ ØµØ¨Ø­Ø§Ù†Ù‡ Ù…ØµØ±Ù Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</p>
                        
                        <div id="weekdaysSection">
                            <!-- Ø±ÙˆØ²Ù‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(39, 174, 96, 0.1); border-radius: 8px;">
                            <p style="color: #155724; font-weight: 600;">
                                <i class="fas fa-info-circle"></i> Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="selectedDaysCount">0</span> Ø±ÙˆØ²
                            </p>
                        </div>
                    </div>
                    
                    <!-- Ø¨Ø®Ø´ Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„ -->
                    <div class="form-section">
                        <h3 class="section-title"><i class="fas fa-utensils"></i> Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„</h3>
                        <p style="color: #666; margin-bottom: 20px;">ÙˆØ¹Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯:</p>
                        
                        <div class="weekend-grid" id="weekendSection">
                            <!-- Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                        </div>
                    </div>
                </div>
                
                <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
                <div style="margin-top: 25px;">
                    <label for="rationNotes" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2c3e50;">
                        <i class="fas fa-sticky-note"></i> ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                    </label>
                    <textarea 
                        id="rationNotes" 
                        rows="3" 
                        placeholder="Ù‡Ø± Ú¯ÙˆÙ†Ù‡ ØªÙˆØ¶ÛŒØ­ ÛŒØ§ Ù†Ú©ØªÙ‡ Ø®Ø§ØµÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
                        style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; resize: vertical;"
                    ></textarea>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
                <div class="form-actions">
                    <button type="button" onclick="resetForm()" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                    </button>
                    
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-check"></i> Ø«Ø¨Øª Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡
                    </button>
                </div>
            </form>
        </div>
        
        <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
        <div class="history-section">
            <div class="history-header">
                <h2><i class="fas fa-history"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø«Ø¨Øªâ€ŒÙ‡Ø§</h2>
                <button onclick="refreshHistory()" class="btn btn-secondary" style="padding: 10px 20px;">
                    <i class="fas fa-sync-alt"></i> Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                </button>
            </div>
            
            <div id="historyContent">
                <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
            
            <!-- Ø¢Ù…Ø§Ø± -->
            <div class="stats-grid" id="statsContainer">
                <!-- Ø¢Ù…Ø§Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
            </div>
        </div>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <button onclick="window.location.href='dashboard.html'" class="back-btn">
        <i class="fas fa-home"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    </button>

    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ ====================
        let currentUser = null;
        let currentRation = null;
        let isDeadlinePassed = false;
        let currentWeek = 1;

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸ“Š ØµÙØ­Ù‡ Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯");
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
            checkLogin();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            loadPageData();
        });

        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
        function checkLogin() {
            const userData = localStorage.getItem('currentUser');
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }
            
            currentUser = JSON.parse(userData);
            updateUserInfo();
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userDorm').textContent = `Ø®ÙˆØ§Ø¨Ú¯Ø§Ù‡: ${currentUser.dormNumber === '0' ? 'ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡' : currentUser.dormNumber}`;
            
            // Ø¢ÙˆØ§ØªØ§Ø±
            const avatar = document.getElementById('userAvatar');
            if (currentUser.fullName) {
                avatar.textContent = currentUser.fullName.charAt(0);
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡
        function loadPageData() {
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ
            currentWeek = getCurrentWeekNumber();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ù‡Ù„Øª Ø«Ø¨Øª
            loadDeadline();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ±Ù…
            loadForm();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            loadHistory();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±
            loadStats();
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ù‡ÙØªÙ‡ Ø¬Ø§Ø±ÛŒ
        function getCurrentWeekNumber() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const pastDaysOfYear = (now - startOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + startOfYear.getDay() + 1) / 7);
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù‡Ù„Øª Ø«Ø¨Øª ====================
        function loadDeadline() {
            let deadline = localStorage.getItem('rationDeadline');
            
            if (!deadline) {
                // Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù‡Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Û· Ø±ÙˆØ² Ø¨Ø¹Ø¯)
                const defaultDeadline = new Date();
                defaultDeadline.setDate(defaultDeadline.getDate() + 7);
                localStorage.setItem('rationDeadline', JSON.stringify(defaultDeadline));
                deadline = JSON.stringify(defaultDeadline);
            }
            
            const deadlineDate = new Date(JSON.parse(deadline));
            const now = new Date();
            isDeadlinePassed = now > deadlineDate;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ù‡Ù„Øª
            const deadlineText = document.getElementById('deadlineText');
            const statusTag = document.getElementById('statusTag');
            
            const persianDate = deadlineDate.toLocaleDateString('fa-IR');
            const time = deadlineDate.toLocaleTimeString('fa-IR', {hour: '2-digit', minute:'2-digit'});
            
            if (isDeadlinePassed) {
                deadlineText.textContent = `${persianDate} Ø³Ø§Ø¹Øª ${time} (Ù…Ù‡Ù„Øª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡)`;
                statusTag.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Ù…Ù‡Ù„Øª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡';
                statusTag.style.background = 'rgba(231, 76, 60, 0.3)';
                statusTag.style.borderColor = 'rgba(231, 76, 60, 0.5)';
                
                // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øª
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-ban"></i> Ù…Ù‡Ù„Øª Ø«Ø¨Øª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡';
            } else {
                const daysLeft = Math.ceil((deadlineDate - now) / (1000 * 60 * 60 * 24));
                deadlineText.textContent = `${persianDate} Ø³Ø§Ø¹Øª ${time} (${daysLeft} Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡)`;
                statusTag.innerHTML = `<i class="fas fa-clock"></i> ${daysLeft} Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡`;
            }
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù… ====================
        function loadForm() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ ÙØ¹Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±
            loadCurrentRation();
            
            // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡
            createWeekdaysForm();
            
            // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„
            createWeekendForm();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙˆÙ†Øªâ€ŒÙ„ÛŒØ³ØªÙ†Ø± Ø¨Ø±Ø§ÛŒ ÙØ±Ù…
            const form = document.getElementById('rationForm');
            form.addEventListener('submit', handleFormSubmit);
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ ÙØ¹Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±
        function loadCurrentRation() {
            const rations = JSON.parse(localStorage.getItem('rations') || '[]');
            currentRation = rations.find(r => 
                r.username === currentUser.username && 
                r.weekNumber === currentWeek
            );
            
            if (currentRation) {
                showMessage('Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯.', 'info');
            }
        }

        // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡
        function createWeekdaysForm() {
            const days = [
                { name: 'Ø´Ù†Ø¨Ù‡', value: 'saturday' },
                { name: 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', value: 'sunday' },
                { name: 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', value: 'monday' },
                { name: 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', value: 'tuesday' },
                { name: 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', value: 'wednesday' }
            ];
            
            let html = '';
            days.forEach(day => {
                const isSelected = currentRation?.breakfastDays?.includes(day.value) || false;
                html += `
                    <div class="day-row">
                        <span class="day-name">${day.name}</span>
                        <div class="day-checkbox">
                            <input 
                                type="checkbox" 
                                id="${day.value}" 
                                ${isSelected ? 'checked' : ''}
                                onchange="updateSelectedDays()"
                            >
                            <label for="${day.value="ØµØ¨Ø­Ø§Ù†Ù‡ </label>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('weekdaysSection').innerHTML = html;
            updateSelectedDays();
        }

        // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹Ø·ÛŒÙ„
        function createWeekendForm() {
            const weekendMeals = [
                { id: 'thursdayBreakfast', label: 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡ ØµØ¨Ø­', icon: 'fa-sun' },
                { id: 'thursdayLunch', label: 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡ Ù†Ø§Ù‡Ø§Ø±', icon: 'fa-utensil-spoon' },
                { id: 'thursdayDinner', label: 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡ Ø´Ø§Ù…', icon: 'fa-moon' },
                { id: 'fridayBreakfast', label: 'Ø¬Ù…Ø¹Ù‡ ØµØ¨Ø­', icon: 'fa-sun' },
                { id: 'fridayLunch', label: 'Ø¬Ù…Ø¹Ù‡ Ù†Ø§Ù‡Ø§Ø±', icon: 'fa-utensil-spoon' },
                { id: 'fridayDinner', label: 'Ø¬Ù…Ø¹Ù‡ Ø´Ø§Ù…', icon: 'fa-moon' }
            ];
            
            let html = '';
            weekendMeals.forEach(meal => {
                const value = currentRation?.[meal.id] || '';
                html += `
                    <div class="weekend-item">
                        <label for="${meal.id}">
                            <i class="fas ${meal.icon}"></i>
                            ${meal.label}
                        </label>
                        <select id="${meal.id}">
                            <option value="" ${!value ? 'selected' : ''}>-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                            <option value="Ø®ÙˆØ±Ø¯Ù‡" ${value === 'Ø®ÙˆØ±Ø¯Ù‡' ? 'selected' : ''}>Ø®ÙˆØ±Ø¯Ù‡â€ŒØ§Ù…</option>
                            <option value="Ù†Ø®ÙˆØ±Ø¯Ù‡" ${value === 'Ù†Ø®ÙˆØ±Ø¯Ù‡' ? 'selected' : ''}>Ù†Ø®ÙˆØ±Ø¯Ù‡â€ŒØ§Ù…</option>
                        </select>
                    </div>
                `;
            });
            
            document.getElementById('weekendSection').innerHTML = html;
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
            if (currentRation?.notes) {
                document.getElementById('rationNotes').value = currentRation.notes;
            }
        }

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        function updateSelectedDays() {
            const checkboxes = document.querySelectorAll('#weekdaysSection input[type="checkbox"]:checked');
            document.getElementById('selectedDaysCount').textContent = checkboxes.length;
        }

        // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‡Ù„Øª
            if (isDeadlinePassed) {
                showMessage('Ù…Ù‡Ù„Øª Ø«Ø¨Øª Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª.', 'error');
                return;
            }
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            const formData = collectFormData();
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!validateFormData(formData)) {
                return;
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            saveRation(formData);
        }

        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù…
        function collectFormData() {
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ ØµØ¨Ø­Ø§Ù†Ù‡
            const breakfastCheckboxes = document.querySelectorAll('#weekdaysSection input[type="checkbox"]:checked');
            const breakfastDays = Array.from(breakfastCheckboxes).map(cb => cb.id);
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø³Ø§ÛŒØ± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            return {
                username: currentUser.username,
                fullName: currentUser.fullName,
                dormNumber: currentUser.dormNumber,
                weekNumber: currentWeek,
                breakfastDays: breakfastDays,
                breakfastCount: breakfastDays.length,
                thursdayBreakfast: document.getElementById('thursdayBreakfast').value,
                thursdayLunch: document.getElementById('thursdayLunch').value,
                thursdayDinner: document.getElementById('thursdayDinner').value,
                fridayBreakfast: document.getElementById('fridayBreakfast').value,
                fridayLunch: document.getElementById('fridayLunch').value,
                fridayDinner: document.getElementById('fridayDinner').value,
                notes: document.getElementById('rationNotes').value.trim(),
                submissionDate: new Date().toISOString(),
                status: 'Ø«Ø¨Øª Ø´Ø¯Ù‡'
            };
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù…
        function validateFormData(data) {
            if (data.breakfastDays.length === 0) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø±ÙˆØ² ØµØ¨Ø­Ø§Ù†Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'error');
                return false;
            }
            
            const requiredFields = [
                'thursdayBreakfast', 'thursdayLunch', 'thursdayDinner',
                'fridayBreakfast', 'fridayLunch', 'fridayDinner'
            ];
            
            for (const field of requiredFields) {
                if (!data[field]) {
                    showMessage(`Ù„Ø·ÙØ§Ù‹ "${getFieldLabel(field)}" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.`, 'error');
                    return false;
                }
            }
            
            return true;
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… ÙØ§Ø±Ø³ÛŒ ÙÛŒÙ„Ø¯
        function getFieldLabel(field) {
            const labels = {
                'thursdayBreakfast': 'ØµØ¨Ø­Ø§Ù†Ù‡ Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡',
                'thursdayLunch': 'Ù†Ø§Ù‡Ø§Ø± Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡',
                'thursdayDinner': 'Ø´Ø§Ù… Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡',
                'fridayBreakfast': 'ØµØ¨Ø­Ø§Ù†Ù‡ Ø¬Ù…Ø¹Ù‡',
                'fridayLunch': 'Ù†Ø§Ù‡Ø§Ø± Ø¬Ù…Ø¹Ù‡',
                'fridayDinner': 'Ø´Ø§Ù… Ø¬Ù…Ø¹Ù‡'
            };
            return labels[field] || field;
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡
        function saveRation(data) {
            let rations = JSON.parse(localStorage.getItem('rations') || '[]');
            
            // Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒÙ† Ù‡ÙØªÙ‡ (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯)
            rations = rations.filter(r => !(r.username === data.username && r.weekNumber === data.weekNumber));
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø´Ù†Ø§Ø³Ù‡
            data.id = Date.now();
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯
            rations.push(data);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('rations', JSON.stringify(rations));
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ú©ÙˆØ±Ø¯ ÙØ¹Ù„ÛŒ
            currentRation = data;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
            showMessage('Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.', 'success');
            
            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØµÙØ­Ù‡
            setTimeout(() => {
                loadHistory();
                loadStats();
                createWeekdaysForm();
                createWeekendForm();
            }, 1000);
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
        function resetForm() {
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
                const checkboxes = document.querySelectorAll('#weekdaysSection input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³Ù„Ú©Øªâ€ŒÙ‡Ø§
                const selects = document.querySelectorAll('#weekendSection select');
                selects.forEach(select => select.value = '');
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙˆØ¶ÛŒØ­Ø§Øª
                document.getElementById('rationNotes').value = '';
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ø´
                updateSelectedDays();
                
                showMessage('ÙØ±Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯.', 'info');
            }
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ØªØ§Ø±ÛŒØ®Ú†Ù‡ ====================
        function loadHistory() {
            const rations = JSON.parse(localStorage.getItem('rations') || '[]');
            const userRations = rations.filter(r => r.username === currentUser.username);
            
            if (userRations.length === 0) {
                document.getElementById('historyContent').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</h3>
                        <p>Ø§ÙˆÙ„ÛŒÙ† Ø«Ø¨Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</p>
                    </div>
                `;
                return;
            }
            
            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
            userRations.sort((a, b) => new Date(b.submissionDate) - new Date(a.submissionDate));
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ù‡ÙØªÙ‡</th>
                                <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
                                <th>ØµØ¨Ø­Ø§Ù†Ù‡</th>
                                <th>Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡</th>
                                <th>Ø¬Ù…Ø¹Ù‡</th>
                                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            userRations.forEach(ration => {
                const date = new Date(ration.submissionDate);
                const isCurrentWeek = ration.weekNumber === currentWeek;
                
                html += `
                    <tr>
                        <td>Ù‡ÙØªÙ‡ ${ration.weekNumber} ${isCurrentWeek ? '(Ø¬Ø§Ø±ÛŒ)' : ''}</td>
                        <td>${date.toLocaleDateString('fa-IR')}</td>
                        <td>${ration.breakfastCount} Ø±ÙˆØ²</td>
                        <td>
                            ${ration.thursdayBreakfast === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">ØµØ¨Ø­</span>' : ''}
                            ${ration.thursdayLunch === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">Ù†Ù‡Ø§Ø±</span>' : ''}
                            ${ration.thursdayDinner === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">Ø´Ø§Ù…</span>' : ''}
                        </td>
                        <td>
                            ${ration.fridayBreakfast === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">ØµØ¨Ø­</span>' : ''}
                            ${ration.fridayLunch === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">Ù†Ù‡Ø§Ø±</span>' : ''}
                            ${ration.fridayDinner === 'Ø®ÙˆØ±Ø¯Ù‡' ? '<span class="tag tag-eaten">Ø´Ø§Ù…</span>' : ''}
                        </td>
                        <td>
                            <span style="color: #27ae60; font-weight: 600;">
                                <i class="fas fa-check-circle"></i> ${ration.status}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('historyContent').innerHTML = html;
        }

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        function refreshHistory() {
            loadHistory();
            loadStats();
            showMessage('ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ Ø¢Ù…Ø§Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.', 'success');
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ù…Ø§Ø± ====================
        function loadStats() {
            const rations = JSON.parse(localStorage.getItem('rations') || '[]');
            const userRations = rations.filter(r => r.username === currentUser.username);
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
            const totalSubmissions = userRations.length;
            const averageBreakfast = totalSubmissions > 0 ? 
                (userRations.reduce((sum, r) => sum + (r.breakfastCount || 0), 0) / totalSubmissions).toFixed(1) : 
                'Û°';
            
            // ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† Ø«Ø¨Øª
            let lastSubmission = 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡';
            if (userRations.length > 0) {
                const lastDate = new Date(userRations[0].submissionDate);
                const now = new Date();
                const diffDays = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) lastSubmission = 'Ø§Ù…Ø±ÙˆØ²';
                else if (diffDays === 1) lastSubmission = 'Ø¯ÛŒØ±ÙˆØ²';
                else lastSubmission = `${diffDays} Ø±ÙˆØ² Ù¾ÛŒØ´`;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ù…Ø§Ø±
            const statsHTML = `
                <div class="stat-card">
                    <i class="fas fa-calendar-check" style="color: #27ae60; font-size: 30px;"></i>
                    <div class="stat-value">${totalSubmissions}</div>
                    <div>ØªØ¹Ø¯Ø§Ø¯ Ø«Ø¨Øªâ€ŒÙ‡Ø§</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-utensils" style="color: #3498db; font-size: 30px;"></i>
                    <div class="stat-value">${averageBreakfast}</div>
                    <div>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ØµØ¨Ø­Ø§Ù†Ù‡</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-clock" style="color: #f39c12; font-size: 30px;"></i>
                    <div class="stat-value">${lastSubmission}</div>
                    <div>Ø¢Ø®Ø±ÛŒÙ† Ø«Ø¨Øª</div>
                </div>
            `;
            
            document.getElementById('statsContainer').innerHTML = statsHTML;
        }

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function showMessage(text, type) {
            // Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù‚Ø¨Ù„ÛŒ
            const oldMessage = document.getElementById('systemMessage');
            if (oldMessage) oldMessage.remove();
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯
            const messageDiv = document.createElement('div');
            messageDiv.id = 'systemMessage';
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${text}
            `;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡
            document.getElementById('messageContainer').prepend(messageDiv);
            
            // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡
            if (type !== 'error') {
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        // ØªØ³Øª Ø³ÛŒØ³ØªÙ…
        function testSystem() {
            console.log("ğŸ§ª ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡:");
            console.log("Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ:", currentUser);
            console.log("Ø¢Ù…Ø§Ø± Ø¬ÛŒØ±Ù‡ ÙØ¹Ù„ÛŒ:", currentRation);
            console.log("Ø´Ù…Ø§Ø±Ù‡ Ù‡ÙØªÙ‡:", currentWeek);
            console.log("Ø¢ÛŒØ§ Ù…Ù‡Ù„Øª Ú¯Ø°Ø´ØªÙ‡:", isDeadlinePassed);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
            const rations = JSON.parse(localStorage.getItem('rations') || '[]');
            console.log("ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±Ù‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡:", rations);
        }

        // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
        // setTimeout(testSystem, 1000);
    </script>
</body>
</html>