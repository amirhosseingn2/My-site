<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ - Ú¯Ø±ÙˆÙ‡Ø§Ù† Ø´Ù‡ÛŒØ¯ ØªÙˆÚ©Ù„ÛŒ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ */
        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .profile-avatar {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid white;
            cursor: pointer;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-edit {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
        }
        
        .profile-info h1 {
            margin: 0;
            font-size: 2rem;
        }
        
        .profile-info p {
            margin: 5px 0;
            opacity: 0.9;
        }
        
        .profile-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .btn {
            padding: 12px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .punishment-status {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .punishment-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .punishment-item:last-child {
            border-bottom: none;
        }
        
        .punishment-level {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .level-low {
            background: #d4edda;
            color: #155724;
        }
        
        .level-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .level-high {
            background: #f8d7da;
            color: #721c24;
        }
        
        .back-btn {
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .password-strength {
            height: 5px;
            margin-top: 5px;
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .strength-weak { background: #e74c3c; width: 30%; }
        .strength-medium { background: #f39c12; width: 60%; }
        .strength-strong { background: #27ae60; width: 100%; }
        
        /* Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
        <a href="dashboard.html" class="back-btn">
            <i class="fas fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        </a>
        
        <!-- Ù‡Ø¯Ø± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
        <div class="profile-header">
            <div class="profile-avatar" id="avatarContainer">
                <img id="avatarImage" src="assets/images/default-avatar.jpg" alt="Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„">
                <div class="avatar-edit">ÙˆÛŒØ±Ø§ÛŒØ´ Ø¹Ú©Ø³</div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;">
            </div>
            <div class="profile-info">
                <h1 id="userFullName">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</h1>
                <p id="userRole">Ù†Ù‚Ø´: Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                <p id="userID">Ú©Ø¯ Ú©Ø§Ø±Ø¨Ø±ÛŒ: -</p>
                <p id="lastLogin">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: -</p>
            </div>
        </div>
        
        <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ -->
        <div class="profile-tabs">
            <button class="tab-btn active" data-tab="info">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</button>
            <button class="tab-btn" data-tab="punishment">ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¨ÛŒÙ‡ÛŒ</button>
            <button class="tab-btn" data-tab="security">Ø§Ù…Ù†ÛŒØª Ø­Ø³Ø§Ø¨</button>
        </div>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
        
        <!-- ØªØ¨ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
        <div id="info-tab" class="tab-content active">
            <h2><i class="fas fa-user-circle"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h2>
            
            <div id="infoAlert" class="alert" style="display: none;"></div>
            
            <form id="personalInfoForm">
                <div class="form-group">
                    <label for="fullName">Ù†Ø§Ù… Ú©Ø§Ù…Ù„:</label>
                    <input type="text" id="fullName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="phoneNumber">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</label>
                    <input type="tel" id="phoneNumber" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="birthDate">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯:</label>
                    <input type="text" id="birthDate" class="form-control" placeholder="Û±Û³Û¸Û°/Û°Û±/Û°Û±">
                </div>
                
                <div class="form-group">
                    <label for="dormNumber">Ø´Ù…Ø§Ø±Ù‡ Ø®ÙˆØ§Ø¨Ú¯Ø§Ù‡:</label>
                    <input type="text" id="dormNumber" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="educationalField">Ø±Ø´ØªÙ‡ ØªØ­ØµÛŒÙ„ÛŒ:</label>
                    <input type="text" id="educationalField" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="bio">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†:</label>
                    <textarea id="bio" class="form-control" rows="4" placeholder="ØªÙˆØ¶ÛŒØ­ Ù…Ø®ØªØµØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®ÙˆØ¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
                </div>
                
                <button type="submit" class="btn">
                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                </button>
            </form>
        </div>
        
        <!-- ØªØ¨ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¨ÛŒÙ‡ÛŒ -->
        <div id="punishment-tab" class="tab-content">
            <h2><i class="fas fa-exclamation-triangle"></i> ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¨ÛŒÙ‡ÛŒ</h2>
            
            <div class="punishment-status">
                <h3>Ø§Ù…ØªÛŒØ§Ø² Ø§Ù†Ø¶Ø¨Ø§Ø·ÛŒ: <span id="disciplineScore">100</span> Ø§Ø² 100</h3>
                <p>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: <span id="disciplineStatus" class="level-low">Ø¹Ø§Ù„ÛŒ</span></p>
                
                <h4>Ø³Ø§Ø¨Ù‚Ù‡ ØªÙ†Ø¨ÛŒÙ‡â€ŒÙ‡Ø§:</h4>
                <div id="punishmentHistory">
                    <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ†Ø¨ÛŒÙ‡ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                    <p id="noPunishments">Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ Ø§Ø² ØªÙ†Ø¨ÛŒÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                <h4><i class="fas fa-info-circle"></i> Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø§Ù†Ø¶Ø¨Ø§Ø·ÛŒ:</h4>
                <p>â€¢ Ø§Ù…ØªÛŒØ§Ø² 80-100: ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ù„ÛŒ</p>
                <p>â€¢ Ø§Ù…ØªÛŒØ§Ø² 60-79: ÙˆØ¶Ø¹ÛŒØª Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„</p>
                <p>â€¢ Ø§Ù…ØªÛŒØ§Ø² 40-59: Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡</p>
                <p>â€¢ Ø§Ù…ØªÛŒØ§Ø² Ø²ÛŒØ± 40: ÙˆØ¶Ø¹ÛŒØª Ø¨Ø­Ø±Ø§Ù†ÛŒ</p>
            </div>
        </div>
        
        <!-- ØªØ¨ Ø§Ù…Ù†ÛŒØª Ø­Ø³Ø§Ø¨ -->
        <div id="security-tab" class="tab-content">
            <h2><i class="fas fa-shield-alt"></i> Ø§Ù…Ù†ÛŒØª Ø­Ø³Ø§Ø¨</h2>
            
            <div id="securityAlert" class="alert" style="display: none;"></div>
            
            <!-- Ø¨Ø®Ø´ ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ -->
            <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0;">
                <h3><i class="fas fa-user-edit"></i> ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</h3>
                <form id="usernameForm">
                    <div class="form-group">
                        <label for="currentUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙØ¹Ù„ÛŒ:</label>
                        <input type="text" id="currentUsername" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="newUsername">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯:</label>
                        <input type="text" id="newUsername" class="form-control" required>
                        <small>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û´ ØªØ§ Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ Ùˆ ÙÙ‚Ø· Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙ Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø´Ø¯.</small>
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-sync-alt"></i> ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
                    </button>
                </form>
            </div>
            
            <!-- Ø¨Ø®Ø´ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± -->
            <div>
                <h3><i class="fas fa-key"></i> ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</h3>
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="currentPassword">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ:</label>
                        <input type="password" id="currentPassword" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯:</label>
                        <input type="password" id="newPassword" class="form-control" required>
                        <div id="passwordStrength" class="password-strength"></div>
                        <small>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¸ Ú©Ø§Ø±Ø§Ú©ØªØ± Ùˆ Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙ Ø¨Ø²Ø±Ú¯ØŒ Ú©ÙˆÚ†Ú© Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø´Ø¯.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯:</label>
                        <input type="password" id="confirmPassword" class="form-control" required>
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-key"></i> ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                    </button>
                </form>
            </div>
            
            <!-- Ø¨Ø®Ø´ Ø­Ø°Ù Ø­Ø³Ø§Ø¨ -->
            <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3><i class="fas fa-trash-alt"></i> Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h3>
                <p>Ø¨Ø§ Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒØŒ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.</p>
                <button id="deleteAccountBtn" class="btn btn-danger">
                    <i class="fas fa-exclamation-triangle"></i> Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸ‘¤ ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯");
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentUser) {
                console.log("ğŸš« Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ØŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯");
                window.location.href = 'index.html';
                return;
            }
            
            console.log("ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡:", currentUser);
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            loadUserProfile(currentUser);
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ¨â€ŒÙ‡Ø§
            setupTabs();
            
            // ØªÙ†Ø¸ÛŒÙ… Ø¢Ù¾Ù„ÙˆØ¯Ø± Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
            setupAvatarUploader();
            
            // ØªÙ†Ø¸ÛŒÙ… ÙØ±Ù…â€ŒÙ‡Ø§
            setupForms();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¨ÛŒÙ‡ÛŒ
            loadPunishmentStatus();
            
            // ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
            setupEventListeners();
        });
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ====================
        
        function loadUserProfile(user) {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù‡Ø¯Ø±
            document.getElementById('userFullName').textContent = user.fullName || 'Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³';
            document.getElementById('userRole').textContent = `Ù†Ù‚Ø´: ${getRoleName(user.role)}`;
            document.getElementById('userID').textContent = `Ú©Ø¯ Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${user.id || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;
            document.getElementById('lastLogin').textContent = `Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: ${user.lastLogin || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
            if (user.avatar) {
                document.getElementById('avatarImage').src = user.avatar;
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø¯Ø± ÙØ±Ù…
            document.getElementById('fullName').value = user.fullName || '';
            document.getElementById('phoneNumber').value = user.phoneNumber || '';
            document.getElementById('birthDate').value = user.birthDate || '';
            document.getElementById('dormNumber').value = user.dormNumber || '';
            document.getElementById('educationalField').value = user.educationalField || '';
            document.getElementById('bio').value = user.bio || '';
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
            document.getElementById('currentUsername').value = user.username || '';
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
            if (!user.birthDate && user.fullName) {
                // ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ ÙØ±Ø¶ÛŒ (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù†Ø·Ù‚ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯)
                document.getElementById('birthDate').value = 'Û±Û³Û·Ûµ/Û°Û¶/Û±Ûµ';
            }
        }
        
        function getRoleName(role) {
            const roles = {
                'admin': 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…',
                'secretary': 'Ù…Ù†Ø´ÛŒ',
                'user': 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ',
                'soldier': 'Ø³Ø±Ø¨Ø§Ø²'
            };
            return roles[role] || role;
        }
        
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Ø­Ø°Ù Ú©Ù„Ø§Ø³ active Ø§Ø² Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ØªØ¨â€ŒÙ‡Ø§
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ active Ø¨Ù‡ ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        function setupAvatarUploader() {
            const avatarContainer = document.getElementById('avatarContainer');
            const avatarInput = document.getElementById('avatarInput');
            
            avatarContainer.addEventListener('click', function() {
                avatarInput.click();
            });
            
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB
                        showAlert('infoAlert', 'Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ú©Ù…ØªØ± Ø§Ø² Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯.', 'danger');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('avatarImage').src = event.target.result;
                        
                        // Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³ Ø¯Ø± localStorage
                        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                        currentUser.avatar = event.target.result;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        showAlert('infoAlert', 'Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        function setupForms() {
            // ÙØ±Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ
            document.getElementById('personalInfoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                currentUser.fullName = document.getElementById('fullName').value;
                currentUser.phoneNumber = document.getElementById('phoneNumber').value;
                currentUser.birthDate = document.getElementById('birthDate').value;
                currentUser.dormNumber = document.getElementById('dormNumber').value;
                currentUser.educationalField = document.getElementById('educationalField').value;
                currentUser.bio = document.getElementById('bio').value;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø¯Ø±
                document.getElementById('userFullName').textContent = currentUser.fullName;
                
                showAlert('infoAlert', 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.', 'success');
            });
            
            // ÙØ±Ù… ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
            document.getElementById('usernameForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newUsername = document.getElementById('newUsername').value.trim();
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
                if (newUsername.length < 4 || newUsername.length > 20) {
                    showAlert('securityAlert', 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û´ ØªØ§ Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.', 'danger');
                    return;
                }
                
                if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
                    showAlert('securityAlert', 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ Ø²ÛŒØ±Ø®Ø· Ø¨Ø§Ø´Ø¯.', 'danger');
                    return;
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÛŒÚ©ØªØ§ Ø¨ÙˆØ¯Ù† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø³Ø±ÙˆØ± Ú†Ú© Ø´ÙˆØ¯)
                // Ø¯Ø± Ø§ÛŒÙ† Ù…Ø«Ø§Ù„ ÙÙ‚Ø· Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙØ¹Ù„ÛŒ Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ø¯
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (newUsername === currentUser.username) {
                    showAlert('securityAlert', 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙØ¹Ù„ÛŒ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ø¯.', 'danger');
                    return;
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
                currentUser.username = newUsername;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯
                document.getElementById('currentUsername').value = newUsername;
                document.getElementById('newUsername').value = '';
                
                showAlert('securityAlert', 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.', 'success');
            });
            
            // ÙØ±Ù… ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ (Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø³Ø±ÙˆØ± Ú†Ú© Ø´ÙˆØ¯)
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                
                // Ø¯Ø± Ø§ÛŒÙ† Ù…Ø«Ø§Ù„ØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ '123456' Ø§Ø³Øª
                if (currentPassword !== '123456') {
                    showAlert('securityAlert', 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.', 'danger');
                    return;
                }
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯
                if (newPassword.length < 8) {
                    showAlert('securityAlert', 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¸ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.', 'danger');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showAlert('securityAlert', 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† ÛŒÚ©Ø³Ø§Ù† Ù†ÛŒØ³ØªÙ†Ø¯.', 'danger');
                    return;
                }
                
                if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(newPassword)) {
                    showAlert('securityAlert', 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙ Ø¨Ø²Ø±Ú¯ØŒ Ú©ÙˆÚ†Ú© Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø´Ø¯.', 'danger');
                    return;
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯)
                currentUser.password = newPassword; // ØªÙˆØ¬Ù‡: Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ù‡Ø±Ú¯Ø² Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ù†Ú©Ù†ÛŒØ¯!
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                showAlert('securityAlert', 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.', 'success');
            });
            
            // Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù Ø­Ø³Ø§Ø¨
            document.getElementById('deleteAccountBtn').addEventListener('click', function() {
                if (confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!')) {
                    if (confirm('âŒ Ø¢ÛŒØ§ Ù‚Ø·Ø¹Ø§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                        // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø°Ù Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
                        localStorage.removeItem('currentUser');
                        window.location.href = 'index.html';
                    }
                }
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø¯Ø±Øª Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            document.getElementById('newPassword').addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
        }
        
        function loadPunishmentStatus() {
            // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³Ø±ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ø´ÙˆÙ†Ø¯
            // Ø¯Ø± Ø§ÛŒÙ† Ù…Ø«Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            
            const punishments = [
                { date: 'Û±Û´Û°Û²/Û°Ûµ/Û±Û°', reason: 'ØªØ£Ø®ÛŒØ± Ø¯Ø± Ù…Ø±Ø§Ø³Ù… ØµØ¨Ø­Ú¯Ø§Ù‡', points: -5, level: 'low' },
                { date: 'Û±Û´Û°Û²/Û°Û´/Û²Û²', reason: 'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ø¯Ø± Ú©Ù„Ø§Ø³ Ø¢Ù…ÙˆØ²Ø´ÛŒ', points: -10, level: 'medium' },
                { date: 'Û±Û´Û°Û²/Û°Û³/Û±Ûµ', reason: 'Ø§Ù†Ø¬Ø§Ù… ÙˆØ¸Ø§ÛŒÙ Ù…Ø­ÙˆÙ„Ù‡ Ø¨Ù‡ Ø®ÙˆØ¨ÛŒ', points: +15, level: 'low' }
            ];
            
            const punishmentHistory = document.getElementById('punishmentHistory');
            const noPunishments = document.getElementById('noPunishments');
            
            if (punishments.length > 0) {
                noPunishments.style.display = 'none';
                
                punishments.forEach(punishment => {
                    const item = document.createElement('div');
                    item.className = 'punishment-item';
                    
                    const levelClass = punishment.level === 'high' ? 'level-high' : 
                                      punishment.level === 'medium' ? 'level-medium' : 'level-low';
                    
                    item.innerHTML = `
                        <div>
                            <strong>${punishment.date}</strong><br>
                            <span>${punishment.reason}</span>
                        </div>
                        <div style="text-align: left;">
                            <span class="punishment-level ${levelClass}">
                                ${punishment.points > 0 ? '+' : ''}${punishment.points} Ø§Ù…ØªÛŒØ§Ø²
                            </span>
                        </div>
                    `;
                    
                    punishmentHistory.appendChild(item);
                });
            }
        }
        
        function setupEventListeners() {
            // Ù‡ÛŒÚ† Ù…ÙˆØ±Ø¯ Ø§Ø¶Ø§ÙÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        
        function showAlert(containerId, message, type) {
            const alertContainer = document.getElementById(containerId);
            alertContainer.textContent = message;
            alertContainer.className = `alert alert-${type}`;
            alertContainer.style.display = 'block';
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                alertContainer.style.display = 'none';
            }, 5000);
        }
        
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('passwordStrength');
            
            if (password.length === 0) {
                strengthBar.className = 'password-strength';
                strengthBar.style.width = '0';
                return;
            }
            
            let strength = 0;
            
            // Ø·ÙˆÙ„ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            if (password.length >= 8) strength += 1;
            if (password.length >= 12) strength += 1;
            
            // ØªÙ†ÙˆØ¹ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§
            if (/[a-z]/.test(password)) strength += 1;
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 2;
            
            // ØªØ¹ÛŒÛŒÙ† Ø³Ø·Ø­ Ù‚Ø¯Ø±Øª
            if (strength <= 2) {
                strengthBar.className = 'password-strength strength-weak';
                strengthBar.style.width = '30%';
            } else if (strength <= 4) {
                strengthBar.className = 'password-strength strength-medium';
                strengthBar.style.width = '60%';
            } else {
                strengthBar.className = 'password-strength strength-strong';
                strengthBar.style.width = '100%';
            }
        }
        
        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ ====================
        window.addEventListener('error', function(e) {
            console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ:', e.error);
        });
    </script>
</body>
</html>